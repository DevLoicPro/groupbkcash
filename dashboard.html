<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GROUPBKCASH</title>
    <!-- On charge Supabase pour vérifier la session réelle si besoin -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
</head>

<body
    style="background: #0a0a0b; color: white; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif;">
    <div style="text-align: center;">
        <div
            style="width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #ff6600; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;">
        </div>
        <p>Chargement de votre espace sécurisé...</p>
    </div>

    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <script>
        async function routeUser() {
            try {
                // On vérifie la session MANUELLE (puisqu'on n'utilise plus Auth)
                const email = localStorage.getItem('sb_user_email');
                const role = localStorage.getItem('sb_user_role');

                if (!email || isSessionExpired()) {
                    clearAuthSession();
                    window.location.href = './login.html';
                    return;
                }

                // Redirection basée sur le rôle stocké lors du login
                if (role && role.toUpperCase() === 'ADMIN') {
                    window.location.href = './dashboard/admin/index.html';
                } else {
                    window.location.href = './dashboard/client/index.html';
                }
            } catch (err) {
                console.error('Routing error:', err);
                window.location.href = 'login.html';
            }
        }

        routeUser();
    </script>
</body>

</html>